<?php /* Template Name: Template Mapa */ ?>

<?php get_header(); ?>
<style type="text/css">
	.marker {
		width: 20px;
		height: 20px;
		border-radius: 50%;
		cursor: pointer;
	}
	.mapboxgl-popup {
		max-width: 300px;
	}
	.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip {
		border-top-color: rgba(0,0,0,0.75);
	}
	.mapboxgl-popup-content {
		text-align: center;
		color:#FFF;
		font-size: 12px;
		background-color:rgba(0,0,0,0.75);
		border-radius: 8px;
		border:0;
		padding: 20px;
	}
	.mapboxgl-popup-content h3 {
		color:#FFF;
		font-size: 14px;
		font-weight: bold;
		margin: 0;
		margin-bottom: 15px;
		margin-top: 15px;
	}
	button.mapboxgl-popup-close-button {
    color: #FFF;
    border: 0;
    outline: none;
	}
	.filter-gbox {
		background-color:#dedede;
		color:#000;
		font-size: 11px;
		border-radius: 8px;
		padding: 5px 10px;
		display: inline-block;
		margin-right: 5px;
	}
	.map-result {
		min-height: 600px;
	}
</style>
<script type="text/javascript">
var gapp = {
	products: [
		{
			"id": "omo",
			"name": "Omo",
			"desc": "Detergente liquido, matic multiacción. Con agentes biodegradables",
			"image": "<?php echo get_theme_file_uri(); ?>/images/products/omo.png",
			"qty": "3 Lt",
			"zones": ["azul","morado"],
			"places": ["lider-santa-amalia","lider-el-rodeo","lider-departamental","sodimac-la-florida","sodimac-limpio-la-reina"],
			"brand":true,
			"pos": true
		},
		{
			"id": "quix",
			"name": "Quix",
			"desc": "Lavalozas líquido concentrado. Pureza esencial. Biodegradable",
			"image": "<?php echo get_theme_file_uri(); ?>/images/products/quix.png",
			"qty": "1.5 Lt",
			"zones": ["azul","morado"],
			"places": ["lider-santa-amalia","lider-el-rodeo","lider-departamental","sodimac-la-florida","sodimac-limpio-la-reina"],
			"brand":true,
			"pos": true
		},
		{
			"id": "soft",
			"name": "Soft",
			"desc": "Suavizante de ropa líquido. Diluido clásico. Biodegradable",
			"image": "<?php echo get_theme_file_uri(); ?>/images/products/soft.png",
			"qty": "1.5 Lt",
			"zones": ["azul","morado"],
			"places": ["lider-santa-amalia","lider-departamental","sodimac-la-florida"],
			"brand":true,
			"pos": true
		},
		{
			"id": "cif",
			"name": "Cif",
			"desc": "Limpiador desengrasante líquido. Antograsa ultra rápido. Biodegradable.",
			"image": "<?php echo get_theme_file_uri(); ?>/images/products/cif.png",
			"qty": "1.5 Lt",
			"zones": ["azul","morado"],
			"places": ["lider-santa-amalia","lider-departamental","sodimac-la-florida"],
			"brand":true,
			"pos": true
		},
		{
			"id": "detergente-lider",
			"name": "Detergente Lider",
			"desc": "Lavalozas líquido Máximo poder desengrasante. Biodegradable.",
			"image": "<?php echo get_theme_file_uri(); ?>/images/products/lider-detergente.png",
			"qty": "3 Lt",
			"zones": [],
			"places": ["lider-santa-amalia","lider-el-rodeo","lider-pie-andino","acuenta-maipu"],
			"brand":true,
			"pos": true
		},
		{
			"id": "lavaloza-lider",
			"name": "Lavaloza Lider",
			"desc": "Lavalozas líquido Máximo poder desengrasante. Biodegradable.",
			"image": "<?php echo get_theme_file_uri(); ?>/images/products/lider-lavaloza.png",
			"qty": "1.5 Lt",
			"zones": [],
			"places": ["lider-santa-amalia","lider-el-rodeo","lider-pie-andino","acuenta-maipu"],
			"brand":true,
			"pos": true
		},
		{
			"id": "suavizante-lider",
			"name": "Suavizante Lider",
			"desc": "Suavizante de ropa clásico. Con agentes biodegradables.",
			"image": "<?php echo get_theme_file_uri(); ?>/images/products/lider-suavizante.png",
			"qty": "1.5 Lt",
			"zones": [],
			"places": ["lider-santa-amalia","lider-el-rodeo","lider-pie-andino","acuenta-maipu"],
			"brand":true,
			"pos": true
		},
		{
			"id": "limpiapisos-lider",
			"name": "Limpiapisos Lider",
			"desc": "Limpiador multiespacios lavanda. Con agentes biodegradables.",
			"image": "<?php echo get_theme_file_uri(); ?>/images/products/lider-limpiapisos.png",
			"qty": "1.5 Lt",
			"zones": [],
			"places": ["lider-santa-amalia","lider-el-rodeo","lider-pie-andino","acuenta-maipu"],
			"brand":true,
			"pos": true
		},
		{
			"id": "purina-raza-grande",
			"name": "Purina raza grande",
			"desc": "Alimento de mascotas Seco/sólido para perros medianos y grandes.",
			"image": "<?php echo get_theme_file_uri(); ?>/images/products/purina-raza-grande.png",
			"qty": "3 a 15 kilos",
			"zones": ["azul"],
			"places": [],
			"brand":false,
			"pos": false
		},
		{
			"id": "purina-raza-chica",
			"name": "Purina raza chica",
			"desc": "Alimento de mascotas Seco/sólido para perros minis y pequeños.",
			"image": "<?php echo get_theme_file_uri(); ?>/images/products/purina-raza-chica.png",
			"qty": "3 a 15 kilos",
			"zones": ["azul"],
			"places": [],
			"brand":false,
			"pos": false
		}
	],
	places: [
		{
			"id": "lider-santa-amalia",
			"name": "Hiper Lider Santa Amalia",
			"address": "Av, Sta. Amalia 1763, La Florida, Región Metropolitana",
			"time": "09:00 a 19:00 hrs",
			"color": "#007DC3",
			"latlng": [-33.544849,-70.5709128]
		},
		{
			"id": "lider-el-rodeo",
			"name": "Lider Express El Rodeo",
			"address": "El Rodeo 12850, Lo Barnechea, Región Metropolitana",
			"time": "09:00 a 19:00 hrs",
			"color": "#007DC3",
			"latlng": [-33.3523407,-70.5229559]
		},
		{
			"id": "lider-pie-andino",
			"name": "Lider Express Pie Andino",
			"address": "Avenida Pie Andino 5885, Los Trapenses, Lo Barnechea, Región Metropolitana",
			"time": "09:00 a 19:00 hrs",
			"color": "#007DC3",
			"latlng": [-33.3241795,-70.5422958]
		},
		{
			"id": "lider-departamental",
			"name": "Lider Departamental",
			"address": "Av. Américo Vespucio 6325, La Florida, Región Metropolitana",
			"time": "09:00 a 19:00 hrs",
			"color": "#007DC3",
			"latlng": [-33.5119906,-70.5939385]
		},
		{
			"id": "acuenta-maipu",
			"name": "Superbodega Acuenta",
			"address": "Av. Sur 411, Maipú",
			"time": "09:00 a 19:00 hrs",
			"color": "#C22026",
			"latlng": [-33.5207115,-70.7669928]
		},
		{
			"id": "sodimac-la-florida",
			"name": "Sodimac La Florida",
			"address": "Av. Macul 6402, La Florida, Región Metropolitana",
			"time": "AM 10:00 a 14:00 hrs y PM 16:00 a 20:00",
			"color": "#8fc6fb",
			"latlng": [-33.5129174,-70.5313586]
		},
		{
			"id": "sodimac-limpio-la-reina",
			"name": "Punto Limpio Sodimac La Reina",
			"address": "Jorge Alessandri 1347, Santiago, La Reina",
			"time": "AM 10:00 a 14:00 hrs y PM 16:00 a 20:00",
			"color": "#8fc6fb",
			"latlng": [-33.4626199,-70.5493846]
		},
	],
	stores: [
		{
			"id": "lider",
			"name": "Lider"
		},
		{
			"id": "acuenta",
			"name": "Acuenta"
		},
		{
			"id": "sodimac",
			"name": "Sodimac"
		},
	],
	mapaColor: {
		"type": "FeatureCollection",
		"name": "Comunas",
		"crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },
		"features": [
			{ "type": "Feature", "properties": { "Name": "Cuadrante 3", "description": "#8A25F5" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.4966538, -33.3653888 ], [ -70.5023187, -33.3686145 ], [ -70.5053227, -33.3699047 ], [ -70.5091851, -33.3703348 ], [ -70.5130475, -33.3711233 ], [ -70.5172103, -33.3724494 ], [ -70.5178648, -33.3726286 ], [ -70.5184816, -33.3729242 ], [ -70.5196778, -33.3734887 ], [ -70.520718, -33.3740065 ], [ -70.5215649, -33.3744167 ], [ -70.5274647, -33.3771367 ], [ -70.5307032, -33.3808381 ], [ -70.5336571, -33.3840053 ], [ -70.537648, -33.3857253 ], [ -70.5410814, -33.3870511 ], [ -70.5442071, -33.3883433 ], [ -70.5486203, -33.3899578 ], [ -70.5569956, -33.393073 ], [ -70.5646849, -33.3954894 ], [ -70.5715948, -33.3976795 ], [ -70.5707574, -33.3995032 ], [ -70.5701351, -33.4015624 ], [ -70.5690119, -33.4040369 ], [ -70.5679586, -33.4071546 ], [ -70.5672527, -33.4089189 ], [ -70.5643321, -33.4179761 ], [ -70.5643497, -33.4229409 ], [ -70.5641096, -33.4240014 ], [ -70.5634404, -33.4250619 ], [ -70.5652065, -33.4309769 ], [ -70.559692, -33.4308248 ], [ -70.5390287, -33.4285582 ], [ -70.5281639, -33.4288584 ], [ -70.5096244, -33.4248469 ], [ -70.5020714, -33.4232709 ], [ -70.5001831, -33.419689 ], [ -70.5025864, -33.4165368 ], [ -70.5000114, -33.4143875 ], [ -70.502057, -33.4103796 ], [ -70.5008697, -33.4040702 ], [ -70.5035812, -33.400224 ], [ -70.5039597, -33.3984811 ], [ -70.5044931, -33.3961575 ], [ -70.5035163, -33.3944008 ], [ -70.5030768, -33.3937032 ], [ -70.501256, -33.3929635 ], [ -70.4993033, -33.3940025 ], [ -70.4981071, -33.3943161 ], [ -70.496825, -33.3941279 ], [ -70.4945182, -33.3926768 ], [ -70.4932735, -33.389201 ], [ -70.4911707, -33.3850086 ], [ -70.4951189, -33.3848653 ], [ -70.4961919, -33.3874095 ], [ -70.4982948, -33.3875886 ], [ -70.4997111, -33.3839336 ], [ -70.4994106, -33.3825719 ], [ -70.4970932, -33.3822136 ], [ -70.4966426, -33.3814789 ], [ -70.4980374, -33.3796692 ], [ -70.4943465, -33.3795617 ], [ -70.4917716, -33.3712473 ], [ -70.4907416, -33.3650826 ], [ -70.4933922, -33.3651827 ], [ -70.4966538, -33.3653888 ] ] ] } },
			{ "type": "Feature", "properties": { "Name": "Cuadrante 1", "description": "#8A25F5" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.5723987, -33.3925548 ], [ -70.5721307, -33.394308 ], [ -70.5715948, -33.3976795 ], [ -70.5539501, -33.3919641 ], [ -70.5438461, -33.3883076 ], [ -70.5336571, -33.3840053 ], [ -70.5274647, -33.3771367 ], [ -70.5178648, -33.3726286 ], [ -70.5193175, -33.3697818 ], [ -70.5242956, -33.3725056 ], [ -70.5304067, -33.3746921 ], [ -70.5329474, -33.3751759 ], [ -70.536604, -33.3764481 ], [ -70.5382037, -33.3758882 ], [ -70.5410908, -33.3747189 ], [ -70.5412002, -33.3734555 ], [ -70.5412472, -33.3723622 ], [ -70.5424488, -33.3716454 ], [ -70.5435646, -33.3698176 ], [ -70.5433929, -33.3684378 ], [ -70.5440796, -33.3679181 ], [ -70.5447233, -33.3664844 ], [ -70.5482853, -33.3633302 ], [ -70.5496478, -33.3600327 ], [ -70.555731, -33.3613948 ], [ -70.5576085, -33.3620757 ], [ -70.558719, -33.3608749 ], [ -70.5622354, -33.3627835 ], [ -70.564679, -33.3648715 ], [ -70.5652798, -33.3630435 ], [ -70.5674684, -33.3646565 ], [ -70.5687559, -33.3659109 ], [ -70.5701292, -33.3670579 ], [ -70.5802572, -33.3669145 ], [ -70.5852354, -33.367918 ], [ -70.5894476, -33.3760721 ], [ -70.5911213, -33.3790108 ], [ -70.5927044, -33.3799921 ], [ -70.5916742, -33.3823395 ], [ -70.5803431, -33.3823608 ], [ -70.5795706, -33.3844392 ], [ -70.5775965, -33.38598 ], [ -70.5729617, -33.3902083 ], [ -70.5723987, -33.3925548 ] ] ] } },
			{ "type": "Feature", "properties": { "Name": "Cuadrante 6", "description": "#0080ff" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.6072939, -33.4116331 ], [ -70.608905, -33.4121603 ], [ -70.6112224, -33.4128051 ], [ -70.6125957, -33.4144529 ], [ -70.6125957, -33.4154559 ], [ -70.6147414, -33.4155992 ], [ -70.6180888, -33.4155992 ], [ -70.6212646, -33.419038 ], [ -70.622552, -33.4219751 ], [ -70.6231528, -33.4244824 ], [ -70.6240112, -33.4251988 ], [ -70.6259853, -33.4251988 ], [ -70.6274444, -33.4262733 ], [ -70.6295205, -33.4280049 ], [ -70.6311942, -33.4296166 ], [ -70.633297, -33.4303329 ], [ -70.6341982, -33.4306552 ], [ -70.6349707, -33.4301538 ], [ -70.6359578, -33.4296166 ], [ -70.6362457, -33.4307883 ], [ -70.6357324, -33.433986 ], [ -70.6354656, -33.4358679 ], [ -70.6347454, -33.4384626 ], [ -70.6338549, -33.441793 ], [ -70.6329537, -33.4447653 ], [ -70.6322241, -33.4476658 ], [ -70.6187173, -33.4448507 ], [ -70.6145975, -33.4469277 ], [ -70.6108209, -33.4464263 ], [ -70.6048986, -33.4451372 ], [ -70.5982038, -33.4447791 ], [ -70.5929681, -33.4476438 ], [ -70.5912944, -33.4456743 ], [ -70.5893633, -33.4432752 ], [ -70.586445, -33.4386913 ], [ -70.5824968, -33.4340357 ], [ -70.5857667, -33.431269 ], [ -70.5934153, -33.4245859 ], [ -70.6014061, -33.4179023 ], [ -70.6065609, -33.415985 ], [ -70.6072939, -33.4116331 ] ] ] } },
			{ "type": "Feature", "properties": { "Name": "Cuadrante 12", "description": "#0080ff" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.5857667, -33.431269 ], [ -70.5824968, -33.4340357 ], [ -70.5799227, -33.4351019 ], [ -70.5735543, -33.4378516 ], [ -70.5721952, -33.4441574 ], [ -70.5705644, -33.4533242 ], [ -70.5721378, -33.4590144 ], [ -70.5615522, -33.46249 ], [ -70.5546857, -33.4626332 ], [ -70.5476476, -33.4633492 ], [ -70.5438711, -33.4636356 ], [ -70.5412961, -33.46249 ], [ -70.545373, -33.4580146 ], [ -70.5436565, -33.4510326 ], [ -70.5437853, -33.4492423 ], [ -70.5435706, -33.4463776 ], [ -70.5432702, -33.4429757 ], [ -70.5431843, -33.4403973 ], [ -70.5426693, -33.4340157 ], [ -70.5390287, -33.4285582 ], [ -70.5598776, -33.4308326 ], [ -70.5720944, -33.4311739 ], [ -70.5857667, -33.431269 ] ] ] } },
			{ "type": "Feature", "properties": { "Name": "Cuadrante 13", "description": "#0080ff" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.5882054, -33.5099687 ], [ -70.5779057, -33.5104697 ], [ -70.5667477, -33.5117578 ], [ -70.5598812, -33.5115432 ], [ -70.5542594, -33.5114 ], [ -70.5538731, -33.5072851 ], [ -70.5537444, -33.506462 ], [ -70.5521994, -33.5000565 ], [ -70.5515557, -33.4973724 ], [ -70.5511265, -33.4947957 ], [ -70.5505257, -33.4926842 ], [ -70.5488956, -33.4867427 ], [ -70.5476933, -33.4848101 ], [ -70.54632, -33.4834858 ], [ -70.5444316, -33.4782598 ], [ -70.5427151, -33.4754676 ], [ -70.5418567, -33.4729976 ], [ -70.540867, -33.4701513 ], [ -70.5404379, -33.4684329 ], [ -70.5399657, -33.4656404 ], [ -70.5390618, -33.4631456 ], [ -70.5412961, -33.46249 ], [ -70.5438711, -33.4636356 ], [ -70.5516378, -33.46295 ], [ -70.5546857, -33.4626332 ], [ -70.5615522, -33.46249 ], [ -70.5721378, -33.4590144 ], [ -70.5749982, -33.4655827 ], [ -70.5767727, -33.4697547 ], [ -70.5782705, -33.4786893 ], [ -70.5805664, -33.4889262 ], [ -70.582755, -33.4928631 ], [ -70.5849438, -33.4967283 ], [ -70.5895787, -33.5055316 ], [ -70.5897503, -33.5081796 ], [ -70.5882054, -33.5099687 ] ] ] } },
			{ "type": "Feature", "properties": { "Name": "Cuadrante 5", "description": "#0080ff" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.6322241, -33.4476658 ], [ -70.625992, -33.4680773 ], [ -70.625477, -33.4692945 ], [ -70.623932, -33.4702253 ], [ -70.6230034, -33.4747843 ], [ -70.6146623, -33.4747358 ], [ -70.6080534, -33.474163 ], [ -70.5985262, -33.4737335 ], [ -70.5918314, -33.4735903 ], [ -70.5887415, -33.4739483 ], [ -70.585909, -33.4735187 ], [ -70.5824758, -33.4728743 ], [ -70.5767727, -33.4697547 ], [ -70.5721378, -33.4590144 ], [ -70.5705644, -33.4533242 ], [ -70.5718236, -33.4456687 ], [ -70.5735543, -33.4378516 ], [ -70.5824968, -33.4340357 ], [ -70.586606, -33.438883 ], [ -70.5882264, -33.4417963 ], [ -70.5927106, -33.4476438 ], [ -70.5979463, -33.4447791 ], [ -70.6046411, -33.4451372 ], [ -70.61434, -33.4469277 ], [ -70.6184598, -33.4448507 ], [ -70.6322241, -33.4476658 ] ] ] } },
			{ "type": "Feature", "properties": { "Name": "Cuadrante 15", "description": "#0080ff" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.6230034, -33.4747843 ], [ -70.6204285, -33.4836615 ], [ -70.6190083, -33.4861993 ], [ -70.6169484, -33.4935722 ], [ -70.6141159, -33.5068847 ], [ -70.6105969, -33.5090317 ], [ -70.6086228, -33.5085308 ], [ -70.5882054, -33.5099687 ], [ -70.5897503, -33.5081796 ], [ -70.5895787, -33.5055316 ], [ -70.5849438, -33.4967283 ], [ -70.5805664, -33.4889262 ], [ -70.5785066, -33.4798111 ], [ -70.5775521, -33.4745303 ], [ -70.5767727, -33.4697547 ], [ -70.5824758, -33.4728743 ], [ -70.5887415, -33.4739483 ], [ -70.5918314, -33.4735903 ], [ -70.599868, -33.4736716 ], [ -70.6133434, -33.4745303 ], [ -70.6230034, -33.4747843 ] ] ] } },
			{ "type": "Feature", "properties": { "Name": "Cuadrante 9", "description": "#0080ff" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.6354656, -33.4358679 ], [ -70.6500568, -33.4321433 ], [ -70.6618156, -33.4289199 ], [ -70.6713428, -33.4261262 ], [ -70.6720146, -33.4283378 ], [ -70.6768211, -33.4265828 ], [ -70.678366, -33.426941 ], [ -70.6797393, -33.4277648 ], [ -70.6806405, -33.4289467 ], [ -70.6805118, -33.4330296 ], [ -70.6801685, -33.4385448 ], [ -70.6790956, -33.4508274 ], [ -70.6777652, -33.4504693 ], [ -70.6782802, -33.4583107 ], [ -70.6790205, -33.4706263 ], [ -70.6715425, -33.4705189 ], [ -70.6715854, -33.4767835 ], [ -70.6694396, -33.4768909 ], [ -70.6654056, -33.4763539 ], [ -70.6628307, -33.4761033 ], [ -70.6609853, -33.4764613 ], [ -70.6591399, -33.4775352 ], [ -70.6569513, -33.4774278 ], [ -70.6546768, -33.4771772 ], [ -70.6529601, -33.4768909 ], [ -70.6495269, -33.4771056 ], [ -70.6482824, -33.4777142 ], [ -70.6421026, -33.4776784 ], [ -70.6402143, -33.4778573 ], [ -70.6376394, -33.4787522 ], [ -70.6350644, -33.4788596 ], [ -70.6333049, -33.4795755 ], [ -70.6308158, -33.4807209 ], [ -70.6296142, -33.4816874 ], [ -70.6278117, -33.4826539 ], [ -70.6262239, -33.4838708 ], [ -70.6249793, -33.4843719 ], [ -70.6193574, -33.4856605 ], [ -70.6204285, -33.4836615 ], [ -70.6230034, -33.4747843 ], [ -70.623932, -33.4702253 ], [ -70.625477, -33.4692945 ], [ -70.6288381, -33.4583585 ], [ -70.6322241, -33.4476658 ], [ -70.6338549, -33.441793 ], [ -70.6354656, -33.4358679 ] ] ] } },
			{ "type": "Feature", "properties": { "Name": "Cuadrante 16", "description": "#0080ff" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.6421026, -33.4776784 ], [ -70.6415588, -33.4821823 ], [ -70.6402284, -33.4918104 ], [ -70.6384689, -33.5072344 ], [ -70.637396, -33.5124229 ], [ -70.6366235, -33.5187917 ], [ -70.6309587, -33.5181835 ], [ -70.6270105, -33.5177184 ], [ -70.6219465, -33.5153211 ], [ -70.6196291, -33.5142477 ], [ -70.6156325, -33.5131502 ], [ -70.6112284, -33.5130133 ], [ -70.6111747, -33.5126376 ], [ -70.6115181, -33.5104907 ], [ -70.6138892, -33.5079501 ], [ -70.6141159, -33.5068847 ], [ -70.6145176, -33.5049773 ], [ -70.6147211, -33.5040281 ], [ -70.6149219, -33.5030766 ], [ -70.6154945, -33.5003289 ], [ -70.6158049, -33.4989461 ], [ -70.6161019, -33.4975589 ], [ -70.6166558, -33.4949687 ], [ -70.6169435, -33.4936647 ], [ -70.6171061, -33.4930328 ], [ -70.6172767, -33.4924031 ], [ -70.6188495, -33.4867848 ], [ -70.6190083, -33.4861993 ], [ -70.6193574, -33.4856605 ], [ -70.6255943, -33.4841151 ], [ -70.6278117, -33.4826539 ], [ -70.6296142, -33.4816874 ], [ -70.6308158, -33.4807209 ], [ -70.6350644, -33.4788596 ], [ -70.6376394, -33.4787522 ], [ -70.6402143, -33.4778573 ], [ -70.6421026, -33.4776784 ] ] ] } },
			{ "type": "Feature", "properties": { "Name": "Cuadrante 22", "description": "#8A25F5" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.6479176, -33.504861 ], [ -70.6529173, -33.5037696 ], [ -70.6577666, -33.5027317 ], [ -70.662026, -33.5014703 ], [ -70.6660977, -33.5002676 ], [ -70.670929, -33.5106991 ], [ -70.6648355, -33.512655 ], [ -70.6579868, -33.5147957 ], [ -70.6402987, -33.5181652 ], [ -70.6366235, -33.5187917 ], [ -70.637396, -33.5124229 ], [ -70.6384689, -33.5072344 ], [ -70.642702, -33.50625 ], [ -70.6479176, -33.504861 ] ] ] } },
			{ "type": "Feature", "properties": { "Name": "Cuadrante 18", "description": "#8A25F5" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.5342124, -33.5459349 ], [ -70.5333111, -33.5365276 ], [ -70.5287192, -33.5312332 ], [ -70.514643, -33.5320203 ], [ -70.5069182, -33.5280493 ], [ -70.5111668, -33.5201069 ], [ -70.5119822, -33.5119849 ], [ -70.5066428, -33.4935296 ], [ -70.518238, -33.5061103 ], [ -70.523817, -33.509295 ], [ -70.5267782, -33.5090803 ], [ -70.5379089, -33.5130789 ], [ -70.5419, -33.5133651 ], [ -70.5421787, -33.5125809 ], [ -70.5434876, -33.5126166 ], [ -70.5542594, -33.5114 ], [ -70.5598812, -33.5115432 ], [ -70.5600153, -33.5118071 ], [ -70.5600637, -33.5124645 ], [ -70.5598384, -33.513368 ], [ -70.5593665, -33.5146264 ], [ -70.5592593, -33.5152794 ], [ -70.5589754, -33.5158698 ], [ -70.5584765, -33.5165273 ], [ -70.5580206, -33.5180255 ], [ -70.5576665, -33.5190542 ], [ -70.556497, -33.5213216 ], [ -70.5563604, -33.5227688 ], [ -70.5563311, -33.5241981 ], [ -70.5559506, -33.5256356 ], [ -70.5558969, -33.5264819 ], [ -70.5553443, -33.5298604 ], [ -70.555355, -33.5310187 ], [ -70.5548991, -33.5324049 ], [ -70.5548561, -33.5349157 ], [ -70.5545986, -33.5362236 ], [ -70.5543463, -33.5369611 ], [ -70.5540994, -33.5377119 ], [ -70.5531019, -33.5400913 ], [ -70.5530563, -33.5406994 ], [ -70.5527103, -33.5424878 ], [ -70.5522597, -33.5434446 ], [ -70.5520237, -33.5465028 ], [ -70.5540408, -33.5480408 ], [ -70.5342124, -33.5459349 ] ] ] } },
			{ "type": "Feature", "properties": { "Name": "Cuadrante 21", "description": "#8A25F5" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.6552509, -33.4772382 ], [ -70.6564394, -33.4797715 ], [ -70.6660977, -33.5002676 ], [ -70.6577666, -33.5027317 ], [ -70.6479176, -33.504861 ], [ -70.6384689, -33.5072344 ], [ -70.6421026, -33.4776784 ], [ -70.6482824, -33.4777142 ], [ -70.6495269, -33.4771056 ], [ -70.6529601, -33.4768909 ], [ -70.6546768, -33.4771772 ], [ -70.6552509, -33.4772382 ] ] ] } },
			{ "type": "Feature", "properties": { "Name": "Cuadrante 17", "description": "#0080ff" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.6123724, -33.5096432 ], [ -70.6115181, -33.5104907 ], [ -70.6111493, -33.5128635 ], [ -70.6109991, -33.5138833 ], [ -70.6109133, -33.5160301 ], [ -70.6101408, -33.5229711 ], [ -70.6097116, -33.5262983 ], [ -70.610012, -33.5343832 ], [ -70.6101408, -33.5372807 ], [ -70.6103124, -33.5410008 ], [ -70.6105306, -33.5456557 ], [ -70.6107452, -33.5466215 ], [ -70.6144359, -33.5464784 ], [ -70.6150367, -33.5466215 ], [ -70.614393, -33.548231 ], [ -70.6126335, -33.5547045 ], [ -70.6109598, -33.5603907 ], [ -70.6106164, -33.5620358 ], [ -70.6126033, -33.5621971 ], [ -70.6124745, -33.5628587 ], [ -70.6121526, -33.5648076 ], [ -70.6117449, -33.5678472 ], [ -70.6115947, -33.5685623 ], [ -70.6114445, -33.5693847 ], [ -70.6113373, -33.5700641 ], [ -70.6106721, -33.5699926 ], [ -70.6086121, -33.5695099 ], [ -70.6065951, -33.5689557 ], [ -70.6041918, -33.5685266 ], [ -70.600072, -33.5673108 ], [ -70.5987356, -33.567232 ], [ -70.5978773, -33.5679114 ], [ -70.5968903, -33.5682333 ], [ -70.5928562, -33.5698781 ], [ -70.5920838, -33.5699139 ], [ -70.5841444, -33.5688769 ], [ -70.5837153, -33.5688054 ], [ -70.584359, -33.5654798 ], [ -70.5816553, -33.5651222 ], [ -70.577793, -33.564407 ], [ -70.5684374, -33.5627978 ], [ -70.5665062, -33.5624402 ], [ -70.5622576, -33.5617965 ], [ -70.5573653, -33.5609383 ], [ -70.5681233, -33.5475415 ], [ -70.5635421, -33.5476041 ], [ -70.5574963, -33.5477183 ], [ -70.5540408, -33.5480408 ], [ -70.5520237, -33.5465028 ], [ -70.5522597, -33.5434446 ], [ -70.5527103, -33.5424878 ], [ -70.552941, -33.5412985 ], [ -70.5530563, -33.5406994 ], [ -70.5531019, -33.5400913 ], [ -70.5532548, -33.539747 ], [ -70.553397, -33.5394385 ], [ -70.5540622, -33.5378735 ], [ -70.5545986, -33.5362236 ], [ -70.5548561, -33.5349157 ], [ -70.5548668, -33.5338313 ], [ -70.5548991, -33.5324049 ], [ -70.555355, -33.5310187 ], [ -70.5553443, -33.5298604 ], [ -70.5556716, -33.5280761 ], [ -70.5558969, -33.5264819 ], [ -70.5559506, -33.5256356 ], [ -70.5560686, -33.5251918 ], [ -70.5563311, -33.5241981 ], [ -70.5563361, -33.5233743 ], [ -70.556497, -33.5213216 ], [ -70.5573124, -33.5197518 ], [ -70.5576665, -33.5190542 ], [ -70.5580206, -33.5180255 ], [ -70.5584765, -33.5165273 ], [ -70.5589754, -33.5158698 ], [ -70.5592593, -33.5152794 ], [ -70.5593665, -33.5146264 ], [ -70.5598384, -33.513368 ], [ -70.5600637, -33.5124645 ], [ -70.5600153, -33.5118071 ], [ -70.5598812, -33.5115432 ], [ -70.5667477, -33.5117578 ], [ -70.5779057, -33.5104697 ], [ -70.5948204, -33.5094918 ], [ -70.6086228, -33.5085308 ], [ -70.6105969, -33.5090317 ], [ -70.6141159, -33.5068847 ], [ -70.6138892, -33.5079501 ], [ -70.6123724, -33.5096432 ] ] ] } },
			{ "type": "Feature", "properties": { "Name": "Cuadrante 19", "description": "#8A25F5" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.5681233, -33.5475415 ], [ -70.5573653, -33.5609383 ], [ -70.584359, -33.5654798 ], [ -70.5837153, -33.5688054 ], [ -70.5920838, -33.5699139 ], [ -70.5928562, -33.5698781 ], [ -70.5978773, -33.5679114 ], [ -70.5987356, -33.567232 ], [ -70.600072, -33.5673108 ], [ -70.6041918, -33.5685266 ], [ -70.6113373, -33.5700641 ], [ -70.6098689, -33.5803826 ], [ -70.6098689, -33.5831355 ], [ -70.6095256, -33.5864962 ], [ -70.6085814, -33.5889629 ], [ -70.6075944, -33.5912866 ], [ -70.6064357, -33.5979714 ], [ -70.6049111, -33.6027213 ], [ -70.6269063, -33.605156 ], [ -70.6266488, -33.618237 ], [ -70.6283654, -33.62567 ], [ -70.630082, -33.634889 ], [ -70.6221856, -33.6343173 ], [ -70.6015862, -33.6311015 ], [ -70.5970372, -33.6332454 ], [ -70.5930031, -33.6348176 ], [ -70.5806435, -33.6302082 ], [ -70.5757512, -33.6265277 ], [ -70.5707301, -33.624598 ], [ -70.5678548, -33.6249911 ], [ -70.5671252, -33.6243121 ], [ -70.5669965, -33.6212389 ], [ -70.5668034, -33.620006 ], [ -70.5637564, -33.6188802 ], [ -70.5592717, -33.6177723 ], [ -70.5559457, -33.6164143 ], [ -70.5493582, -33.6151992 ], [ -70.546719, -33.6147168 ], [ -70.5410112, -33.6143772 ], [ -70.5379642, -33.6157531 ], [ -70.5353571, -33.616727 ], [ -70.5318059, -33.6155923 ], [ -70.5290164, -33.6146274 ], [ -70.5238665, -33.6158425 ], [ -70.5194892, -33.6153064 ], [ -70.518073, -33.613448 ], [ -70.5172147, -33.6129834 ], [ -70.512966, -33.6135195 ], [ -70.510949, -33.612626 ], [ -70.5091895, -33.6100884 ], [ -70.5146612, -33.6039944 ], [ -70.5076122, -33.6012243 ], [ -70.504383, -33.5973816 ], [ -70.5059279, -33.5797927 ], [ -70.5333937, -33.5833679 ], [ -70.5359365, -33.5795422 ], [ -70.5339302, -33.5740719 ], [ -70.5342201, -33.5713006 ], [ -70.5392302, -33.5614849 ], [ -70.5371274, -33.5600545 ], [ -70.5384148, -33.5536171 ], [ -70.5413605, -33.5545817 ], [ -70.5432763, -33.5547953 ], [ -70.5459001, -33.555277 ], [ -70.5475799, -33.5550434 ], [ -70.5486341, -33.5544667 ], [ -70.5488969, -33.5535637 ], [ -70.5489667, -33.553215 ], [ -70.5492081, -33.552902 ], [ -70.5521907, -33.5516858 ], [ -70.5535211, -33.5516322 ], [ -70.5533303, -33.5490318 ], [ -70.5540408, -33.5480408 ], [ -70.5574963, -33.5477183 ], [ -70.5681233, -33.5475415 ] ] ] } },
			{ "type": "Feature", "properties": { "Name": "Cuadrante 8", "description": "#8A25F5" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.6354656, -33.4358679 ], [ -70.6362457, -33.4307883 ], [ -70.6359578, -33.4296166 ], [ -70.6377477, -33.428711 ], [ -70.6379623, -33.4271351 ], [ -70.637576, -33.424413 ], [ -70.6371898, -33.423231 ], [ -70.6378335, -33.4226937 ], [ -70.6395502, -33.420867 ], [ -70.6397218, -33.4202223 ], [ -70.6389064, -33.4197924 ], [ -70.6374473, -33.4186103 ], [ -70.6363315, -33.4171417 ], [ -70.633542, -33.4165686 ], [ -70.6331987, -33.4159238 ], [ -70.6305379, -33.4142402 ], [ -70.6281347, -33.4151357 ], [ -70.6275339, -33.41467 ], [ -70.6256456, -33.4150283 ], [ -70.6240148, -33.4137029 ], [ -70.622899, -33.4126282 ], [ -70.6229848, -33.4115893 ], [ -70.6230707, -33.409619 ], [ -70.6217403, -33.4078278 ], [ -70.6200237, -33.4076487 ], [ -70.6190795, -33.4058933 ], [ -70.6204099, -33.4054634 ], [ -70.618865, -33.4020957 ], [ -70.6208391, -33.3990504 ], [ -70.6217663, -33.3982187 ], [ -70.6270878, -33.3931667 ], [ -70.635113, -33.3872903 ], [ -70.6419365, -33.3824885 ], [ -70.6460993, -33.3805534 ], [ -70.6567852, -33.3766114 ], [ -70.6576435, -33.3778657 ], [ -70.6577723, -33.3787258 ], [ -70.6576865, -33.3805893 ], [ -70.6571286, -33.3866095 ], [ -70.6575148, -33.3887236 ], [ -70.6571715, -33.3928442 ], [ -70.6575148, -33.3951732 ], [ -70.6577133, -33.3975512 ], [ -70.6582926, -33.4001308 ], [ -70.657196, -33.4053463 ], [ -70.6535719, -33.4062571 ], [ -70.6534861, -33.4113442 ], [ -70.6544302, -33.4113442 ], [ -70.6544731, -33.4147652 ], [ -70.6529282, -33.4150518 ], [ -70.6528424, -33.4177025 ], [ -70.6501816, -33.4177742 ], [ -70.6512974, -33.4254394 ], [ -70.6519411, -33.4315819 ], [ -70.6354656, -33.4358679 ] ] ] } },
			{ "type": "Feature", "properties": { "Name": "Cuadrante 7", "description": "#0080ff" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.6582516, -33.4005426 ], [ -70.6606978, -33.4009367 ], [ -70.6609982, -33.3993603 ], [ -70.6648445, -33.3990692 ], [ -70.6661936, -33.3989864 ], [ -70.6675213, -33.399002 ], [ -70.6680363, -33.3990513 ], [ -70.667811, -33.3995977 ], [ -70.6720756, -33.399844 ], [ -70.672242, -33.3996111 ], [ -70.6748169, -33.4006501 ], [ -70.6788509, -33.4021549 ], [ -70.6816673, -33.4029789 ], [ -70.6805246, -33.4052001 ], [ -70.6801813, -33.4061316 ], [ -70.6788939, -33.4153023 ], [ -70.6784218, -33.4182397 ], [ -70.6770485, -33.4201381 ], [ -70.6749886, -33.4213201 ], [ -70.6728857, -33.4235767 ], [ -70.6718128, -33.4251169 ], [ -70.6713428, -33.4261262 ], [ -70.6618156, -33.4289199 ], [ -70.6519411, -33.4315819 ], [ -70.6501816, -33.4177742 ], [ -70.6524972, -33.4174285 ], [ -70.6529282, -33.4150518 ], [ -70.6544731, -33.4147652 ], [ -70.6544302, -33.4113442 ], [ -70.6534861, -33.4113442 ], [ -70.6535719, -33.4062571 ], [ -70.657196, -33.4053463 ], [ -70.6582516, -33.4005426 ] ] ] } },
			{ "type": "Feature", "properties": { "Name": "Cuadrante 10", "description": "#8A25F5" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.7240962, -33.4104422 ], [ -70.7219657, -33.4120516 ], [ -70.7186183, -33.4137711 ], [ -70.7157, -33.4150606 ], [ -70.7169016, -33.4174965 ], [ -70.7201632, -33.4306058 ], [ -70.7215365, -33.4365509 ], [ -70.7169016, -33.4372672 ], [ -70.7129963, -33.4378044 ], [ -70.7106789, -33.4381267 ], [ -70.7070848, -33.4380461 ], [ -70.7071706, -33.4398367 ], [ -70.7072779, -33.4414661 ], [ -70.7073208, -33.4476611 ], [ -70.706956, -33.4488249 ], [ -70.7047673, -33.4484847 ], [ -70.7016989, -33.4481266 ], [ -70.698094, -33.447679 ], [ -70.6924725, -33.4479862 ], [ -70.6923004, -33.4469629 ], [ -70.6921073, -33.444492 ], [ -70.6906053, -33.4444025 ], [ -70.6865712, -33.4442056 ], [ -70.684168, -33.4440802 ], [ -70.6797072, -33.4438267 ], [ -70.6804343, -33.4347155 ], [ -70.6806405, -33.4289467 ], [ -70.6797393, -33.4277648 ], [ -70.678366, -33.426941 ], [ -70.6768211, -33.4265828 ], [ -70.6775161, -33.4261378 ], [ -70.6792327, -33.4254572 ], [ -70.6817433, -33.4248125 ], [ -70.6835457, -33.4226634 ], [ -70.6843611, -33.4217859 ], [ -70.6882234, -33.4181771 ], [ -70.6954761, -33.4120874 ], [ -70.7044132, -33.4067497 ], [ -70.7113656, -33.4071258 ], [ -70.7146528, -33.4077788 ], [ -70.7240962, -33.4104422 ] ] ] } },
			{ "type": "Feature", "properties": { "Name": "Cuadrante 20", "description": "#8A25F5" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.7628462, -33.4634927 ], [ -70.7611552, -33.4690853 ], [ -70.7553168, -33.4791799 ], [ -70.7590934, -33.4760299 ], [ -70.7857704, -33.4911599 ], [ -70.7843971, -33.4961704 ], [ -70.7864733, -33.4969324 ], [ -70.796258, -33.5001891 ], [ -70.7994338, -33.5043402 ], [ -70.7992621, -33.5196547 ], [ -70.7987471, -33.5259515 ], [ -70.8002063, -33.5319616 ], [ -70.8012362, -33.5346088 ], [ -70.8045836, -33.5436944 ], [ -70.7930823, -33.5503471 ], [ -70.7919502, -33.5516956 ], [ -70.7711096, -33.5582867 ], [ -70.7622528, -33.5446854 ], [ -70.7608958, -33.5299582 ], [ -70.7417556, -33.5192969 ], [ -70.7400389, -33.5100656 ], [ -70.7329845, -33.4959556 ], [ -70.7247473, -33.4913752 ], [ -70.7227732, -33.4906594 ], [ -70.7239873, -33.4877144 ], [ -70.7248456, -33.4849942 ], [ -70.7243306, -33.4818444 ], [ -70.7233006, -33.4796252 ], [ -70.7221848, -33.4731818 ], [ -70.73021, -33.470676 ], [ -70.7363319, -33.4686091 ], [ -70.7371828, -33.4682184 ], [ -70.7524831, -33.465843 ], [ -70.7608721, -33.4644951 ], [ -70.7628462, -33.4634927 ] ] ] } },
			{ "type": "Feature", "properties": { "Name": "Cuadrante 2", "description": "#8A25F5" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.5927044, -33.3799921 ], [ -70.6017503, -33.3828196 ], [ -70.6015104, -33.3894292 ], [ -70.6039654, -33.396353 ], [ -70.6035885, -33.4025245 ], [ -70.6072939, -33.4116331 ], [ -70.6008087, -33.4084622 ], [ -70.5933746, -33.4063221 ], [ -70.590727, -33.4052598 ], [ -70.5880365, -33.40452 ], [ -70.5852817, -33.4035472 ], [ -70.5821837, -33.4020728 ], [ -70.5715948, -33.3976795 ], [ -70.5724392, -33.3923494 ], [ -70.5729617, -33.3902083 ], [ -70.5775965, -33.38598 ], [ -70.5795706, -33.3844392 ], [ -70.5803431, -33.3823608 ], [ -70.5916742, -33.3823395 ], [ -70.5927044, -33.3799921 ] ] ] } },
			{ "type": "Feature", "properties": { "Name": "Cuadrante 4", "description": "#0080ff" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.5821837, -33.4020728 ], [ -70.5852817, -33.4035472 ], [ -70.5880365, -33.40452 ], [ -70.590727, -33.4052598 ], [ -70.5929592, -33.4062126 ], [ -70.6008087, -33.4084622 ], [ -70.6072939, -33.4116331 ], [ -70.6065609, -33.415985 ], [ -70.6047706, -33.4167634 ], [ -70.6011348, -33.4181686 ], [ -70.5928241, -33.4253776 ], [ -70.5857667, -33.431269 ], [ -70.573947, -33.4311413 ], [ -70.5652065, -33.4309769 ], [ -70.5634404, -33.4250619 ], [ -70.5641096, -33.4240014 ], [ -70.5643497, -33.4229409 ], [ -70.5643321, -33.4179761 ], [ -70.5662686, -33.4121635 ], [ -70.5673398, -33.4087719 ], [ -70.5690119, -33.4040369 ], [ -70.5702836, -33.4013657 ], [ -70.5707574, -33.3995032 ], [ -70.5715948, -33.3976795 ], [ -70.5821837, -33.4020728 ] ] ] } },
			{ "type": "Feature", "properties": { "Name": "Cuadrante 11", "description": "#8A25F5" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.5020714, -33.4232709 ], [ -70.5281639, -33.4288584 ], [ -70.5390287, -33.4285582 ], [ -70.5426693, -33.4340157 ], [ -70.5430877, -33.4398473 ], [ -70.5434579, -33.4454668 ], [ -70.5437396, -33.4491001 ], [ -70.5436565, -33.4510326 ], [ -70.545373, -33.4580146 ], [ -70.5412961, -33.46249 ], [ -70.5313826, -33.4653899 ], [ -70.5296232, -33.4591961 ], [ -70.5139591, -33.4603777 ], [ -70.502832, -33.4540733 ], [ -70.5001176, -33.4437582 ], [ -70.5020714, -33.4232709 ] ] ] } },
			{ "type": "Feature", "properties": { "Name": "Cuadrante 14", "description": "#8A25F5" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -70.5139591, -33.4603777 ], [ -70.5296232, -33.4591961 ], [ -70.5313826, -33.4653899 ], [ -70.5390618, -33.4631456 ], [ -70.5399657, -33.4656404 ], [ -70.5404379, -33.4684329 ], [ -70.540867, -33.4701513 ], [ -70.5418567, -33.4729976 ], [ -70.5427151, -33.4754676 ], [ -70.5444316, -33.4782598 ], [ -70.54632, -33.4834858 ], [ -70.5488956, -33.4867427 ], [ -70.5511265, -33.4947957 ], [ -70.5517594, -33.4982043 ], [ -70.5538731, -33.5072851 ], [ -70.5542594, -33.5114 ], [ -70.5434876, -33.5126166 ], [ -70.5421787, -33.5125809 ], [ -70.5419, -33.5133651 ], [ -70.5379089, -33.5130789 ], [ -70.5267782, -33.5090803 ], [ -70.523817, -33.509295 ], [ -70.518238, -33.5061103 ], [ -70.5066428, -33.4935296 ], [ -70.5077522, -33.477513 ], [ -70.5131648, -33.4694893 ], [ -70.5139591, -33.4603777 ] ] ] } }
		]
	},
	renderProducts: function(zone) {
		var html = "";
		for (var i = 0; i < this.products.length; i++) {
			if ((!zone || this.products[i].zones.indexOf(zone)) && this.products[i].pos) {
				html += '<div class="item change-places">'+
	              '      <label class="wrapper-checkbox">'+
	              '        <input id="product-'+this.products[i].id+'" name="products" checked type="checkbox" value="'+this.products[i].id+'">'+
	              '        <span class="checkmark"></span>'+
	              '        <div class="overlay"></div>'+
	              '      </label>'+
	              '      <div class="thumb">'+
	              '        <img src="'+this.products[i].image+'" class="" alt="product">'+
	              '      </div>'+
	              '      <div class="info">'+
	              '        <div class="name">'+this.products[i].name+'</div>'+
	              '        <div class="desc">'+this.products[i].desc+'</div>'+
	              '        <div class="qty">'+this.products[i].qty+'</div>'+
	              '      </div>'+
	              '</div>';
      		}
		}

		return html;
	},
	renderPlaces: function(second) {
		// Get mark products
		var okPlaces = [];
		var that = this;
		jQuery.each(jQuery(".wrapper-checkbox").find(":checked"), function(i,v) {
			var id = jQuery(this).attr("id").replace("product-","");
			for (var j = 0; j < that.products.length; j++) {
				if (that.products[j].id == id) {
					for (var k = 0; k < that.products[j].places.length; k++) {
						if (okPlaces.indexOf(that.products[j].places[k]) == -1) {
							okPlaces.push(that.products[j].places[k]);
						}
					}
				}
			}
		});  

		for (var i = 0; i < this.places.length; i++) {
			if (okPlaces.indexOf(this.places[i].id)>-1) {
				var f = 0;
				for (var j = 0; j < markers.length; j++) {
					if (markers[j].id == this.places[i].id) {
						f = 1;
						break;
					}
				}
				if (f==0) {
					var el = document.createElement('div');
					el.className = 'marker marker-clicks';
					el.setAttribute('data-id', this.places[i].id);
					el.style = 'background-color:'+this.places[i].color;
					
					var latlng = this.places[i].latlng.slice().reverse();
					var oneMarker = new mapboxgl.Marker(el).setLngLat(latlng).setPopup(
						new mapboxgl.Popup({ offset: 25 }).setHTML(
							`<h3>${this.places[i].name}</h3><p>${this.places[i].address}</p>`
						)
					);
					oneMarker.addTo(map);  
					markers.push({
						id: this.places[i].id,
						marker: oneMarker
					});
				}
			}
			else {
				//try remove
				for (var j = 0; j < markers.length; j++) {
					if (markers[j].id == this.places[i].id) {
						markers[j].marker.remove();
						markers.splice(j,1);
					}
				}
			}
		}
	},
	renderStoresListing: function() {
		var html = "";
		for (var i = 0; i < this.stores.length; i++) {
      		html += '<li>'+
              '<label class="item-checkbox" for="shop-'+this.stores[i].id+'">' + this.stores[i].name + '' + 
              '<input id="shop-'+this.stores[i].id+'" class="filter-store-class" name="shopFilter" type="checkbox" value="shop'+this.stores[i].id+'">'+
              '<span class="checkmark"></span>'+
              '</label>'+
              '</li>';
		}
		return html;
	},
	renderProductsListing: function() {
		var html = "";
		for (var i = 0; i < this.products.length; i++) {
			if (this.products[i].brand) {
          html += '<li>'+
          '<label class="item-checkbox" for="filter-'+this.products[i].id+'">'+ this.products[i].name + '' + 
          '<input id="filter-'+this.products[i].id+'" class="filter-products-class" name="shopBrand" type="checkbox" value="'+this.products[i].id+'">'+
          '<span class="checkmark"></span>'+
          '</label>'+
          '</li>';
			} 
		}
		return html;
	},
	applyFilters: function() {
		if (tags.length > 0) {
			var that = this;
			jQuery(".change-places").find("input").prop("checked", false);
			jQuery(".change-places").hide();
			jQuery.each(jQuery(".change-places"), function(i,v) {
				for (var x = 0; x < tags.length; x++) {
					if (tags[x].indexOf("filter")==0) { // Is product
						var t = tags[x].replace("filter","product");
						var p = jQuery(this).find("input").attr('id');
						if (t == p) {
							jQuery(this).show();
							jQuery(this).find("input").prop("checked",true);
						}
					}
					else { // is shop
						var fo = tags[x].replace("shop-","");
						var p = jQuery(this).find("input").attr('id');

						// buscar el tag del producto
						var f = 0;
						var r = that.products.filter(function(item) { return item.id == p.replace('product-','') });
						if (r.length > 0) {
							for (var k = 0; k < r[0].places.length; k++) {
								console.log(r[0].places[k],' => ', fo, " == ", r[0].places[k].indexOf(fo));
								if (r[0].places[k].indexOf(fo)>=0) {
									f = 1; 
									break;
								}
							}
							if (f==1) {
								jQuery(this).show();
								jQuery(this).find("input").prop("checked",true);
							} 
						}
					}

				}

			});
		}
		else {
			jQuery(".change-places").find("input").prop("checked", true);
			jQuery(".change-places").show();
		}
		this.renderPlaces();
	},
	makeSwiper: function(color) {
		var html = "";
		html += ''+
			    '<div class="swiper-container">'+
			    '  <div class="swiper-delivery swiper-delivery-'+color+'">'+
			    '    <div class="swiper-wrapper" id="swiper-slide-'+color+'"> ';

			    for (var i = 0; i < this.products.length; i++) {
			    	if (this.products[i].zones.indexOf(color) > -1) {
							html += '<div class="swiper-slide"><img src="'+this.products[i].image+'" class="" alt="product"></div>';
			    	}
			    }

			    html+='</div>'+
			    '  </div>'+
			    '  <div class="swiper-button swiper-button-prev prev-'+color+'"></div>'+
			    '  <div class="swiper-button swiper-button-next next-'+color+'"></div>'+
			    '</div>';

    	return html;
	},
	renderPolygons: function() {
		if (!definedLayers) {
			for (var i = 0; i < this.mapaColor.features.length; i++) {
				var dt = this.mapaColor.features[i];

		      	map.addSource('maine'+i, {
		            'type': 'geojson',
		            'data': dt
		        });

		        // Add a new layer to visualize the polygon.
		        map.addLayer({
		            'id': 'l_maine'+i,
		            'type': 'fill',
		            'source': 'maine'+i, // reference the data source
		            'layout': {},
		            'paint': {
		                'fill-color': this.mapaColor.features[i].properties.description, // blue color fill
		                'fill-opacity': 0.5
		            }
		        });
		        // Add a black outline around the polygon.
		        map.addLayer({
		            'id': 'outline'+i,
		            'type': 'line',
		            'source': 'maine'+i,
		            'layout': {},
		            'paint': {
		                'line-color': '#000',
		                'line-width': 1
		            }
		        });
		        definedLayers = true;
			}
		}
		else {
			for (var i = 0; i < this.mapaColor.features.length; i++) { 
				map.setLayoutProperty('outline'+i, 'visibility', 'visible');
				map.setLayoutProperty('l_maine'+i, 'visibility', 'visible');
			}
		}
	},
	okPoints: function() {
		this.renderPlaces();
	},
	offPoints: function() {
		for (var j = 0; j < markers.length; j++) {
			markers[j].marker.remove();
		}
		markers = [];
	},
	offPolygons: function() {
		for (var i = 0; i < this.mapaColor.features.length; i++) {
			map.setLayoutProperty('outline'+i, 'visibility', 'none');
			map.setLayoutProperty('l_maine'+i, 'visibility', 'none');
		}
	}
}


var map = null;
var markers = [];
var tags = [];
var definedLayers = false;

jQuery(document).ready(function() {
	
	jQuery(".result-list").html(gapp.renderProducts());
	jQuery("#results-stores").html(gapp.renderStoresListing());
	jQuery("#results-products").html(gapp.renderProductsListing());

	jQuery(document).on("click",".marker-clicks",function() {
		var d = jQuery(this).attr('data-id');
		jQuery("#clearFilters").click();
		for (var i = 0; i < gapp.products.length; i++) {
			if (gapp.products[i].places.indexOf(d) > -1) {
				jQuery("#product-" + gapp.products[i].id).prop("checked",true);
			}
			else {
				jQuery("#product-" + gapp.products[i].id).prop("checked",false);
			}
		}

	});
	jQuery("#switchView").change(function() {
		if (jQuery(this).is(":checked")) {
	    	gapp.renderPolygons();
	    	gapp.offPoints();
		}
		else {
			gapp.offPolygons();
			gapp.okPoints();
		}
	});
	jQuery("#labelDLVR").click(function() {
    	gapp.renderPolygons();
    	gapp.offPoints();
	});
	jQuery("#labelPOS").click(function() {
		gapp.offPolygons();
		gapp.okPoints();
	});
	jQuery("#clearFilters").click(function() {
		tags = [];
		jQuery(".filter-gbox").remove();
		jQuery(this).hide();
		jQuery(".change-places").show();
		jQuery(".filter-store-class,.filter-products-class").prop("checked",false);
		gapp.applyFilters();
	});
	jQuery(".change-places>label>input").click(function() {
		console.log('.change-places::click');
		gapp.renderPlaces();
	});

	jQuery(".filter-store-class,.filter-products-class").click(function() {
		if (tags.indexOf(jQuery(this).attr('id')) > -1) {
			jQuery("[data-id='box-"+jQuery(this).attr('id')+"']").remove();
			var ii = tags.indexOf(jQuery(this).attr('id'));
			tags.splice(ii,1);
		}
		else {
			jQuery("#tags-area").append('<span class="filter-gbox" data-id="box-'+jQuery(this).attr('id')+'">'+jQuery(this).parent().text()+'</span>');
			tags.push(jQuery(this).attr('id'));
		}

		if (tags.length > 0) {
			jQuery("#clearFilters").show();
			jQuery("#showingAll").hide();	
		}
		else {
			jQuery("#clearFilters").hide();	
			jQuery("#showingAll").show();
			jQuery(".change-places").show();
		}
		gapp.applyFilters();
	});
	
	mapboxgl.accessToken = 'pk.eyJ1IjoiYWxncmFtbyIsImEiOiJjbDNrN3dnMHUwN3lrM2NxYXd1N3BzcnRzIn0.mDAq3_Hkv0OuUo6S6edoNA';

	map = new mapboxgl.Map({
	  container: 'mapboxgl',
	  style: 'mapbox://styles/algramo/cl4f5mzdy000d14miprq08p54',
	  center: [-70.604,-33.517],
	  zoom: 10
	});

	gapp.renderPlaces();
	jQuery("#swiper-azul").html(gapp.makeSwiper('azul'));
	jQuery("#swiper-morado").html(gapp.makeSwiper('morado'));


    var swiper1 = new Swiper('.swiper-delivery-morado', {
      slidesPerView: "auto",
      // loop: true,
      navigation: {
        nextEl: '.next-morado',
        prevEl: '.prev-morado',
      },
    });
    var swiper2 = new Swiper('.swiper-delivery-azul', {
      slidesPerView: "auto",
      // loop: true,
      navigation: {
        nextEl: '.next-azul',
        prevEl: '.prev-azul',
      },
    });


    <?php 
    if ($_GET["places"]) { echo "map.on('load', () => jQuery(\"#labelDLVR\").click() );"; }
    ?>

    

});

</script>
<div id="mapPage" class="animate__animated animate__fadeIn">

  <section id="mapPage" class="no-header-page">
    <div class="bg-white py-3 text-center d-block d-md-none">
      <p class="fw-bold mb-0"><?php _e('¿Que productos estas buscando?'); ?></p>
    </div>

    <div class="filter-wrapper">
      <div class="container-fluid h-100">
        <div class="row h-100 align-items-center">
          <div class="col h-100">
            <div class="map-filter">

              <div class="filter-item sep pe-3 d-flex align-items-center d-none d-md-inline-flex">
                <button id="labelPOS" type="button" class="btn btn-link text-decoration-none switch-label text-primary"><?php _e('Ver puntos de venta'); ?></button>
                <label class="switch mx-2">
                  <input id="switchView" type="checkbox" role="switch">
                  <span class="slider round"></span>
                </label>
                <button id="labelDLVR" type="button" class="btn btn-link text-decoration-none switch-label"><?php _e('Ver comunas de despacho'); ?></button>
              </div>
              <div class="filter-item sep px-3 d-none d-md-inline-flex">
                <div id="selectShop" class="dropdow-checkbox-multiselect">
                  <div class="dropbtn dropbtn-shop"><?php _e('Selecciona tienda'); ?></div>
                  <ul class="options" id="results-stores">
                  </ul>
                </div>
              </div>
              <div class="filter-item sep px-3 d-none d-md-inline-flex">
               <div id="selectBrand" class="dropdow-checkbox-multiselect">
                  <div class="dropbtn dropbtn-brand"><?php _e('Selecciona Marca'); ?></div>
                  <ul class="options" id="results-products"> 
                  </ul>
                </div>
              </div>
              <div class="filter-item d-none d-md-inline-flex">
                <button style="display:none;" id="clearFilters" type="button" class="btn btn-link text-decoration-none"><i class="fa-solid fa-xmark fa-xl me-2"></i> <?php _e('Borrar filtros'); ?></button>
              </div>

              <!-- Mobile filter -->
              <div class="filter-item first sep pe-3 d-flex align-items-center d-inline-flex d-md-none ">
                <select class="form-select border-0" aria-label="Default select example">
                  <option value="0" selected><?php _e('Ver puntos de venta'); ?></option>
                  <option value="1"><?php _e('Comunas de despacho'); ?></option>
                </select>
              </div>
              <div class="filter-item px-3 d-inline-flex d-md-none">
                <button id="mobileFilterTrigger" type="button" class="btn btn-primary btn-sm d-flex align-items-center justify-content-center text-white rounded-pill px-3">
                  <?php _e('Filtros'); ?> <img src="<?php echo get_theme_file_uri(); ?>/images/svg/icon-filter.svg" class="ms-1" alt="icono filtrar">
                </button>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="filter-wrapper-mobile d-block d-md-none open">
      <div class="box">
        <div class="container">
          <div class="row">
            <div class="col">

              <div class="header-box text-center">
                <div class="graber"></div>
                <h5 class="fw-bolder mb-0">Filtros</h5>
              </div>
              <div class="body-box">
                <h6 class="fw-bolder">Selecciona tienda</h6>
                <ul id="results-stores-mobile">
                  <li>
                    <label class="item-checkbox" for="1"> filtro 1
                      <input id="1" class="filter-store-class" name="shopFilter" type="checkbox" value="value">
                      <span class="checkmark"></span>
                    </label>
                  </li>
                </ul>
                <hr>
                <div class="">Selecciona Marca</div>
                <ul id="results-products-mobile">
                  <li>
                    <label class="item-checkbox" for="1"> filtro 1
                      <input id="1" class="filter-store-class" name="shopFilter" type="checkbox" value="value">
                      <span class="checkmark"></span>
                    </label>
                  </li>
                </ul>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="map-result">

      <div id="mapboxgl" class="map-wrapper sticky-top">map-wrapper</div>

      <div class="result-items-wrapper py-4">

        <div id="resPOS">
          <div class="container-fluid">
            <div class="row align-items-center mb-4 d-none d-md-flex">
              <div class="col">
                <p class="fw-bold mb-0"><?php _e('¿Que productos estas buscando?'); ?></p>
              </div>
              <div class="col">
                <small class="d-block text-end text-muted" id="tags-area">
                	<span id="showingAll"><?php _e('Mostrando todos los productos'); ?></span>
                </small>
              </div>
            </div>
            <div class="row">
              <div class="col">

                <div class="result-list"></div>

                <!-- ::::::: result-list mobile ::::::: -->
                <!-- <div class="carousel-map-products position-relative">
                  <div class="swiper-wrapper">
                    <div class="swiper-slide">
                      <div class="item">
                        <label class="wrapper-checkbox">
                          <input id="product-'+this.products[i].id+'" name="products" checked type="checkbox" value="'+this.products[i].id+'">
                          <span class="checkmark"></span>
                          <div class="overlay"></div>
                        </label>
                        <div class="thumb">
                          <img src="<?php echo get_theme_file_uri(); ?>/images/products/omo.png" class="" alt="product">
                        </div>
                        <div class="info">
                          <div class="name">Omo</div>
                          <div class="desc">Detergente liquido, matic multiacción. Con agentes biodegradables</div>
                          <div class="qty">3 Litros</div>
                        </div>
                      </div>
                    </div>
                    <div class="swiper-slide">
                      <div class="item">
                        <label class="wrapper-checkbox">
                          <input id="product-'+this.products[i].id+'" name="products" checked type="checkbox" value="'+this.products[i].id+'">
                          <span class="checkmark"></span>
                          <div class="overlay"></div>
                        </label>
                        <div class="thumb">
                          <img src="<?php echo get_theme_file_uri(); ?>/images/products/omo.png" class="" alt="product">
                        </div>
                        <div class="info">
                          <div class="name">Omo</div>
                          <div class="desc">Detergente liquido, matic multiacción. Con agentes biodegradables</div>
                          <div class="qty">3 Litros</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="btn-swiper button-next"><i class="fa-solid fa-angle-right"></i></div>
                  <div class="btn-swiper button-prev"><i class="fa-solid fa-angle-left"></i></div>
                </div> -->

              </div>
            </div>
          </div>
        </div>

        <div id="resDLVR" class="inactive">
          <div class="container-fluid">
            <div class="row align-items-center mb-4">
              <div class="col">
                <p class="fw-bold mb-0"><?php _e('Productos disponibles en la'); ?> <span style="color: #0080ff;"><?php _e('zona azul'); ?></span></p>
              </div>
              <div class="col d-none d-md-inline-flex">
                <small class="d-block text-end text-muted"><?php _e('Mostrando todos los productos'); ?></small>
              </div>
            </div>

            <div class="row mb-4">
              <div class="col px-4 overflow-hidden" id="swiper-azul"></div>
            </div>
            
            <div class="row align-items-center mb-4">
              <div class="col">
                <p class="fw-bold mb-0"><?php _e('Productos disponibles en la'); ?> <span style="color: #8A25F5;"><?php _e('zona morada'); ?></span></p>
              </div>
            </div>

            <div class="row">
              <div class="col px-4 overflow-hidden" id="swiper-morado"></div>
            </div>
          </div>
        </div>

      </div>      
    </div>

  </section>

</div>

<?php get_footer(); ?>